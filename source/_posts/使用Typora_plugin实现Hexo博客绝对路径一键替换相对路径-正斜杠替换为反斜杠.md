---
title: ä½¿ç”¨Typora_pluginå®ç°Hexoåšå®¢ç»å¯¹è·¯å¾„ä¸€é”®æ›¿æ¢ç›¸å¯¹è·¯å¾„|æ­£æ–œæ æ›¿æ¢ä¸ºåæ–œæ 
tags:
  - Typora
  - Hexo
  - Typora-plugin
categories:
  - Hexo
  - blog-post
  - Typora-plugin
abbrlink: 520cc65
date: 2024-02-08 15:24:23

---

# ä½¿ç”¨ Typora_plugin å®ç° Hexo åšå®¢ç»å¯¹è·¯å¾„ä¸€é”®æ›¿æ¢ç›¸å¯¹è·¯å¾„|æ­£æ–œæ æ›¿æ¢ä¸ºåæ–œæ 

ä»Šå¤©ä¸‹åˆå¶ç„¶çš„å‘ç°ï¼Œè§£å†³äº†æˆ‘å¾ˆä¹…ä»¥æ¥ä¸€ç›´æƒ³è§£å†³çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨ Hexo åšå®¢ä¸Šä¼ çš„æ—¶å€™æˆ‘ä¸€èˆ¬æ˜¯æŠŠå›¾ç‰‡æ’å…¥è¿›å»ï¼Œä½†æ˜¯é»˜è®¤çš„è·¯å¾„æ˜¯ç»å¯¹è·¯å¾„ï¼Œæ›¾ç»åœ¨ Typora è®¾ç½®é‡Œæ”¹è¿‡ï¼Œä½†æ˜¯æ•ˆæœä¹Ÿä¸å¥½ï¼Œä»Šå¤©æƒ³èµ·äº† Typora pluginï¼Œäºæ˜¯æƒ³åŸºäº Typora plugin å¼€å‘ä¸€ä¸ªæ’ä»¶

é¦–å…ˆæ„Ÿè°¢ Typora plugin å¼€å‘è€… https://github.com/obgnail/typora_plugin/

çœŸå¿ƒæ„Ÿè°¢æ’ä»¶å¼€å‘å¤§ä½¬ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­

æˆ‘æŠŠé—®é¢˜æŠ›ç»™å¤§ä½¬ï¼Œå¤§ä½¬è½®å­éƒ½ç»™æˆ‘é€ å¥½äº†ï¼Œè€Œä¸”è¿˜æœ‰ç¤¼è²Œï¼Œæˆ‘è¯´æˆ‘å†™ä¸ªå®‰è£…æ–‡æ¡£æä¾›ç»™å…¶ä»–æœ‰éœ€è¦çš„ç”¨æˆ·ä½¿ç”¨ï¼Œä»–ç”šè‡³è¿˜éº»çƒ¦æˆ‘

![image-20240208160233056](../img/Typora_plugin/ReplaceBackslash/image-20240208160233056.png)

![image-20240208160340371](../img/Typora_plugin/ReplaceBackslash/image-20240208160340371.png)

![image-20240208160411419](../img/Typora_plugin/ReplaceBackslash/image-20240208160411419.png)

![image-20240208164539253](../img/Typora_plugin/ReplaceBackslash/image-20240208164539253.png)

![image-20240208172549961](../img/Typora_plugin/ReplaceBackslash/image-20240208172549961.png)

## è„šæœ¬é€‚ç”¨æƒ…å†µ

è¯¥è„šæœ¬ä¸»è¦å®ç°åŠŸèƒ½æ˜¯ï¼ŒMarkdown ä¸­æ‰€æœ‰çš„å›¾ç‰‡è·¯å¾„ä¸­æ­£æ–œæ ä¸€é”®æ›¿æ¢ä¸ºåæ–œæ ï¼Œå¹¶æŠŠåŒ…å«../img/çš„è·¯å¾„æ›¿æ¢ä¸ºç›¸å¯¹è·¯å¾„ï¼Œæ–¹ä¾¿ Hexo åšå®¢ä¸Šä¼ 

ä¾‹å¦‚ Markdown ä¸­æ–‡ä»¶è·¯å¾„æ˜¯ `[ç¤ºä¾‹å›¾ç‰‡](F:/Hexo/source../img/test.png)`

æ›¿æ¢åçš„è·¯å¾„å°±æ˜¯ `[ç¤ºä¾‹å›¾ç‰‡](../img/test.png)`

æœ¬è„šæœ¬é€‚ç”¨äºï¼šHexo åšå®¢å†™ä½œæ’ç‰ˆï¼ŒHexo å›¾ç‰‡æ”¾åœ¨/source/æ–‡ä»¶ä¸‹çš„ Hexo åšå®¢ä½œè€…

## å®‰è£… Typora plugin

æœ‰å…³æ’ä»¶çš„å®‰è£…æ•™ç¨‹å¯ä»¥çœ‹å®˜æ–¹çš„ä»“åº“ï¼ŒReadme å†™çš„å¾ˆè¯¦ç»†äº†

https://github.com/obgnail/typora_plugin/

## åˆ›å»º JS

åœ¨ `./plugin/custom/plugins/ReplaceBackslash.js` æ–‡ä»¶ä¸­åˆ›å»º js æ–‡ä»¶ï¼ŒæŠŠä¸‹é¢ä»£ç å¤åˆ¶è¿›å»ã€‚

```javascript
class ReplaceBackslash extends BaseCustomPlugin {
    hotkey = () => [this.config.hotkey]
    callback = async anchorNode => {
        const filepath = this.utils.getFilePath();
        const content = await this.utils.Package.Fs.promises.readFile(filepath, 'utf-8');
        const replacedContent = await this.format(content);
        await this.utils.Package.Fs.promises.writeFile(filepath, replacedContent);
        File.reloadContent(replacedContent, { fromDiskChange: false });
    }

    format = async content => {
        const dir = this.utils.getCurrentDirPath();
        const imgFolder = this.config.img_folder;
        const regexp = this.config.ignore_image_div
            ? new RegExp("!\\[.*?\\]\\((?<src1>.*)\\)", "g")
            : new RegExp("!\\[.*?\\]\\((?<src1>.*)\\)|<img.*?src=\"(?<src2>.*?)\"", "g");

        return await this.asyncReplace(content, regexp, async (match, src1, src2) => {
            const src = src1 || src2;

            // è·³è¿‡ç‰¹æ®Šæ ¼å¼çš„å›¾ç‰‡ï¼ˆå¦‚base64ï¼‰å’Œç½‘ç»œå›¾ç‰‡
            if (!src || this.utils.isSpecialImage(src) || this.utils.isNetworkImage(src)) return match;

            // æ£€æµ‹å›¾ç‰‡æ˜¯å¦å­˜åœ¨äºå½“å‰ç”µè„‘ä¸­ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™ä¸å¤„ç†
            // å¦‚æœä¸å¸Œæœ›æ£€æµ‹ï¼Œå¯ä»¥æ³¨é‡Šæ‰ä¸‹é¢ä¸¤è¡Œ
            const realPath = await this.checkImageExist(dir, src);
            if (!realPath) {
                // å¦‚æœè·¯å¾„ä¸­æ²¡æœ‰åæ–œæ ï¼Œåˆ™æ£€æŸ¥æ˜¯å¦ä½äºæŒ‡å®šçš„ img æ–‡ä»¶å¤¹ä¸­
                if (!src.includes('\\') && !src.includes('/')) {
                    const imgPath = this.utils.Package.Path.resolve(dir, imgFolder, src);
                    if (await this.utils.existPath(imgPath)) {
                        // å¦‚æœå›¾ç‰‡å­˜åœ¨äºæŒ‡å®šçš„ img æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ™è¿”å›å¤„ç†åçš„è·¯å¾„
                        return this.replaceBackslash(match, src, imgPath);
                    }
                }
                // å¦‚æœè·¯å¾„ä¸­æ— åæ–œæ å¹¶ä¸”ä¸åœ¨æŒ‡å®šçš„ img æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ™ä¿æŒåŸæ ·
                return match;
            }

            // è¿›è¡Œè·¯å¾„æ›¿æ¢å¹¶å¤„ç†åæ–œæ 
            return this.replaceBackslash(match, src, realPath);
        });
    }

    // æ›¿æ¢è·¯å¾„é€»è¾‘
    replaceBackslash = (match, src, realPath) => {
        // å°†è·¯å¾„ä¸­çš„åæ–œæ  \ æ›¿æ¢ä¸ºæ–œæ  /
        const replacedSrc = realPath.replace(/\\/g, '/');
        const index = match.indexOf(src);
        return match.slice(0, index) + match.slice(index).replace(src, replacedSrc);
    }

    asyncReplace = (content, regexp, placement) => {
        let match;
        let lastIndex = 0;
        const promises = [];

        while ((match = regexp.exec(content))) {
            const str = content.slice(lastIndex, match.index);
            lastIndex = regexp.lastIndex;
            const args = [match[0], match.groups?.src1, match.groups?.src2, match.index, match.input];
            const promise = placement(...args);
            promises.push(str, promise);
        }
        promises.push(content.slice(lastIndex));
        return Promise.all(promises).then(results => results.join(""));
    }

    checkImageExist = async (currentDir, path) => {
        let absolutePath = this.utils.Package.Path.resolve(currentDir, path);

        while (!(await this.utils.existPath(absolutePath))) {
            const idx = absolutePath.lastIndexOf(")");
            if (idx === -1) {
                return null;
            } else {
                absolutePath = absolutePath.slice(0, idx);
            }
        }
        return absolutePath;
    }
}

module.exports = { plugin: ReplaceBackslash };

```

## å¯ç”¨æ’ä»¶

1. ä¿®æ”¹ `./plugin/global/settings/custom_plugin.user.toml`ï¼Œæ·»åŠ é…ç½®ï¼š

```toml
[ReplaceBackslash]
name = "æ›¿æ¢åæ–œæ ä¸ºæ­£æ–œæ "
enable = true

[ReplaceBackslash.config]
# æ˜¯å¦å¿½ç•¥htmlæ ‡ç­¾<img src="example.jpg">é‡Œçš„èµ„æºï¼ˆmarkdownæ˜¯æ”¯æŒæ’å…¥htmlçš„ï¼Œæ­¤é€‰é¡¹é—®æ˜¯å¦è¦å¿½ç•¥imgæ ‡ç­¾ï¼‰
ignore_image_div = false
img_folder = "img"          #è¿™é‡Œå¼•å·å†…çš„å†…å®¹æ”¹ä¸ºä½ è‡ªå·±çš„æ–‡ä»¶å¤¹å‘½å
```

è¿™é‡Œå¼•å·å†…çš„å†…å®¹æ”¹ä¸ºä½ è‡ªå·±çš„æ–‡ä»¶å¤¹å‘½å

## æ·»åŠ å¿«æ·æ–¹å¼

### æ·»åŠ å¿«æ·é”®

ä¿®æ”¹ `./plugin/global/settings/custom_plugin.user.toml`ï¼Œæ·»åŠ é…ç½®

åœ¨ä¸Šä¸€æ­¥çš„åŸºç¡€ä¸Šï¼Œç»§ç»­æ·»åŠ ä¸€è¡Œä»£ç 

```toml
[ReplaceBackslash.config]
# æ˜¯å¦å¿½ç•¥htmlæ ‡ç­¾<img src="example.jpg">é‡Œçš„èµ„æºï¼ˆmarkdownæ˜¯æ”¯æŒæ’å…¥htmlçš„ï¼Œæ­¤é€‰é¡¹é—®æ˜¯å¦è¦å¿½ç•¥imgæ ‡ç­¾ï¼‰
ignore_image_div = false
img_folder = "img"
# å¿«æ·é”®ï¼ˆè‹¥ä¸º""ï¼Œåˆ™ä¸æ³¨å†Œï¼‰
hotkey = "ctrl+shift+m"
```

è¿™é‡Œå¿«æ·é”®è®¾ç½®ä¸º `ctrl+shift+m` å¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦ä¿®æ”¹

### æ·»åŠ å¿«æ·æŒ‰é’®

åœ¨ä¸Šä¸€æ­¥çš„åŸºç¡€ä¸Šï¼Œç»§ç»­æ·»åŠ ä»£ç 

```toml
[quickButton]
[quickButton.config]
#   disable:      ç¦ç”¨æ­¤æŒ‰é’®
#   coordinate:   æŒ‰é’®åæ ‡ã€‚å¾€ä¸Šä¸ºxè½´æ­£æ–¹å‘ï¼Œå¾€å·¦ä¸ºyè½´æ­£æ–¹å‘ï¼Œä»é›¶å¼€å§‹è®¡æ•°
#   icon:         æŒ‰é’®å›¾æ ‡ã€‚å¡«å…¥css classã€‚æ”¯æŒfont-awesome-4.1.0å’Œionicons-2.0.1ï¼Œæ‰€æœ‰çš„å›¾æ ‡åŠå…¶å¯¹åº”çš„css classè¯·å‚è€ƒï¼šhttps://www.adfwebmagazine.jp/wp-content/uploads/test_v4.1.pdf  å’Œ  https://ionic.io/ionicons/v2
#   size(å¯é€‰):    å›¾æ ‡å¤§å°ã€‚é»˜è®¤17px
#   color(å¯é€‰):   å›¾æ ‡é¢œè‰²ã€‚é»˜è®¤è·Ÿéšå½“å‰ä¸»é¢˜çš„é…è‰²æ–¹æ¡ˆ
#   bgColor(å¯é€‰): å›¾æ ‡èƒŒæ™¯è‰²ã€‚é»˜è®¤è·Ÿéšå½“å‰ä¸»é¢˜çš„é…è‰²æ–¹æ¡ˆ
#   hint:         æç¤ºä¿¡æ¯
#   callback:     å›è°ƒå‡½æ•°ã€‚é‡‡ç”¨pluginName.MethodNameçš„å½¢å¼ï¼ˆåŠŸèƒ½å°±åƒhotkey.default.tomlä¸­çš„pluginå‚æ•°å’Œfunctionå‚æ•°çš„åˆä½“ï¼‰
#                     MethodNameè¯·é€šè¿‡é˜…è¯»æºç æŸ¥æ‰¾ã€‚å¦‚æœæ‚¨ä¸æ‡‚ä»£ç ï¼Œä½†è¿˜æ˜¯æƒ³æ·»åŠ æŒ‰é’®ï¼Œæœ‰ä¸ªç¢°è¿æ°”æŠ€å·§ï¼šåœ¨ã€å³é”®èœå•->å¸¸ç”¨æ’ä»¶->è‡ªå®šä¹‰æ’ä»¶ä¸‹çš„æ’ä»¶ã€‘åŸºæœ¬éƒ½æ˜¯XXX.callbackï¼Œå…¶ä½™æ’ä»¶åŸºæœ¬éƒ½æ˜¯XXX.call
#   evil(å±é™©):    è‡ªå®šä¹‰å›è°ƒå‡½æ•°ã€‚åŠŸèƒ½åŒhotkey.default.tomlä¸­çš„evilå‚æ•°ï¼ˆå®ƒèƒ½ç”¨çš„ï¼Œè¿™é‡Œä¹Ÿèƒ½ç”¨ï¼‰ã€‚è¿™é‡Œçš„æ–‡æœ¬å†…å®¹ä¼šè¢«eval()ã€‚å¦‚æœè®¾ç½®æ­¤å‚æ•°ï¼Œcallbackå‚æ•°ä¼šå¤±æ•ˆ
buttons = [
    # é»˜è®¤çš„æŒ‰é’®
    { disable = false, coordinate = [0, 0], hint = "ç›´è¾¾åº•éƒ¨", size = "28px", icon = "fa fa-angle-down", callback = "go_top.goBottom" },
    { disable = false, coordinate = [1, 0], hint = "ç›´è¾¾é¡¶éƒ¨", size = "28px", icon = "fa fa-angle-up", callback = "go_top.goTop" },
    { disable = false, coordinate = [2, 0], hint = "æ–‡å­—é£æ ¼", size = "17px", icon = "fa fa-font", callback = "text_stylize.call" },
    { disable = false, coordinate = [3, 0], hint = "æ··æ’ä¼˜åŒ–", size = "17px", icon = "fa fa-align-justify", callback = "md_padding.call" },
    { disable = false, coordinate = [0, 1], hint = "æ€ç»´å¯¼å›¾", size = "22px", icon = "fa fa-code-fork", callback = "markmap.onButtonClick" },
    { disable = false, coordinate = [1, 1], hint = "å›¾ç‰‡ç®¡ç†", size = "17px", icon = "fa fa-image", callback = "imageReviewer.callback" },
    { disable = false, coordinate = [2, 1], hint = "ä¹¦ç­¾ç®¡ç†", size = "17px", icon = "fa fa-bookmark", callback = "scrollBookmarker.callback" },
    { disable = false, coordinate = [3, 1], hint = "é«˜äº®æœç´¢", size = "17px", icon = "fa fa-search", callback = "search_multi.call" },

    # ä½ çš„æŒ‰é’®
    { disable = false, coordinate = [4, 1], hint = "æ­£æ–œæ æ›¿æ¢æ–œæ ", size = "17px", icon = "fa fa-book", callback = "ReplaceBackslash.callback" },
]
```

é‡å¯ Typora å°±å¯ä»¥åœ¨å³ä¸‹è§’çœ‹åˆ°æ·»åŠ çš„å¿«æ·æŒ‰é’®

## æ•ˆæœå±•ç¤º

![end](../img/Typora_plugin/ReplaceBackslash/end.gif)

## æ›´æ–°æ—¥å¿—

2024 å¹´ 2 æœˆ 8 æ—¥ ï¼Œ ä¿®äº†ä¸€å¤„æ²¡æœ‰è€ƒè™‘åˆ°çš„ bugï¼ŒåŸå…ˆåªèƒ½è½¬æ¢ç»å¯¹è·¯å¾„ï¼Œå¯¹äºï¼ˆ..../img/ï¼‰å½¢å¼çš„è·¯å¾„ä¸ä¼šå¤„ç†ï¼Œä¿®å¤åä¹ŸåŒ…æ‹¬äº†è¿™ç§æƒ…å†µï¼Œå…·ä½“æ”¹åŠ¨å¯ä»¥æŸ¥çœ‹ç¼–è¾‘å†å²

2024 å¹´ 2 æœˆ 8 æ—¥ ï¼Œé‡å†™äº†ä»£ç é€»è¾‘ï¼Œæ”¹ä¸ºå…ˆè¿›è¡Œåæ–œæ æ›¿æ¢ï¼Œç„¶åè¿›è¡Œè·¯å¾„é‡å†™ä¸ºç›¸å¯¹è·¯å¾„

2024 å¹´ 2 æœˆ 8 æ—¥ ï¼Œå¢åŠ äº†ä¸€ä¸ªå®ç°æ•ˆæœ GIF æ¼”ç¤º

2024 å¹´ 2 æœˆ 8 æ—¥ ï¼Œå—ä½œè€…å¯å‘ï¼Œå°†ä»£ç ä¸­ç¡¬ç¼–ç çš„ ../img/ æ”¹æˆä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œè„šæœ¬ä½¿ç”¨è€…å¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦ä¿®æ”¹é…ç½®å˜é‡çš„å†…å®¹

2024 å¹´ 2 æœˆ 9 æ—¥ ï¼Œä»£ç å·²æ›´æ–°ï¼Œç»è¿‡ä½œè€…çš„æ–½æ•™ï¼Œå¢å¼ºäº†å›¾ç‰‡è·¯å¾„çš„åŒ¹é…ï¼Œè§£å†³äº†åŸå…ˆæ›¿æ¢å…¨æ–‡\çš„é—®é¢˜ï¼Œç°åœ¨åªæ›¿æ¢å›¾ç‰‡è·¯å¾„ï¼Œæ’ä»¶ä½œè€…å¤ªå¼ºäº†

å¦‚å›¾

![39744b9eade1b1f68271869e78e3a50e](../img/Typora_plugin/ReplaceBackslash/39744b9eade1b1f68271869e78e3a50e.png)

![0096befcd128b3bf9346b755fe9e2ccf](../img/Typora_plugin/ReplaceBackslash/0096befcd128b3bf9346b755fe9e2ccf.png)

2024 å¹´ 2 æœˆ 10 æ—¥ï¼Œå¤§ä½¬å¸®å¿™æŠ“è™«ï¼Œçº æ­£äº†å¿«æ·é”®çš„é…ç½®

2024 å¹´ 2 æœˆ 18 æ—¥ï¼Œå¤§ä½¬æŒ‡å‡ºé”™è¯¯ï¼Œä¿®æ”¹äº†å¿«æ·é”®çš„é”™è¯¯

## é¸£è°¢

æ„Ÿè°¢ Typora_plugin ä½œè€…ï¼Œæå¤§åœ°æ–¹ä¾¿äº†æˆ‘çš„å†™ä½œ

æ„Ÿè°¢ ChatGPTï¼Œç»™äº†æˆ‘ä»£ç å†™ä½œçš„å¼€å¤´

1. https://github.com/obgnail/typora_plugin/issues/467
2. https://w1ndys.top/
3. https://chat.openai.com/

---

æ–‡ç« æ¥è‡ª https://blog.w1ndys.top/posts/520cc65
