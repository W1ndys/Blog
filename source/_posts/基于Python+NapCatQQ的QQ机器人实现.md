---
title: åŸºäºPython+NapCatQQçš„QQæœºå™¨äººå®ç°
tags:
  - QQbot
  - QQæœºå™¨äºº
  - Python
  - NapCatQQ
categories:
  - QQbot
cover: "https://camo.githubusercontent.com/19e013c69403957fa4b7be7cadb1bd96d3f9294de754e8bf893e7fdd13bea628/68747470733a2f2f736f6369616c6966792e6769742e63692f4e61704e656b6f2f4e617043617451512f696d6167653f6465736372697074696f6e3d31266c616e67756167653d31266c6f676f3d68747470732533412532462532467261772e67697468756275736572636f6e74656e742e636f6d2532464e61704e656b6f2532464e617043617451512532466d61696e2532466c6f676f2e706e67266e616d653d31267374617267617a6572733d31267468656d653d4175746f"
abbrlink: "56783215"
date: 2024-07-28 17:57:32
---

## å¼€å‘èƒŒæ™¯

> ä¹Ÿæ˜¯æˆ‘ä¸ QQbot ä¹‹é—´çš„ç¾ç»Šå§ï¼Œä½œè€…çš„ä¸€äº›ç¢ç¢å¿µ

ä¹…è¿äº†å•Šï¼Œè€å‹ï¼Œè¯´ä¸å‡ºçš„æ„Ÿè§‰æ¶Œä¸Šå¿ƒå¤´ ğŸ˜‡

è¿˜è®°å¾—é‚£ä¼šæ˜¯åˆä¸­ï¼Œå¿˜äº†ä¸Šå‡ å¹´çº§äº†ï¼Œå¤§æ¦‚åœ¨ 17 å¹´å·¦å³è®¤è¯†äº†é…· Qï¼Œåªèƒ½ç”¨åˆ«äººçš„æ’ä»¶ä¸ä¼šè‡ªå·±å¼€å‘åŠŸèƒ½ï¼Œå­¦äº†ä¸€æ®µæ—¶é—´è‹¦äºç¯å¢ƒä¸ä¼šé…ç½®æ”¾å¼ƒäº†ï¼Œåæ¥ 18ï¼Œ19 å¹´å·¦å³è®¤è¯†äº† QRspeedï¼ˆ-dicï¼‰ï¼ŒåŸºäºå…³é”®è¯çš„è¯åº“ç¨‹åºï¼Œçœ‹ç€è¯­æ³•æ–‡æ¡£è‡ªå·±å†™å‡ºæ¥ä¸€å¥—ï¼ˆå¤§æ¦‚ 4000 è¡Œå·¦å³å§ï¼‰è‡ªå·±ç”¨çš„æºç ï¼ˆä¸¥æ ¼æ¥è¯´åº”è¯¥å«è¯åº“ç§°ä¸ä¸Šæ˜¯æºç ï¼‰ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡è‡ªå·±å†™è‡ªå·±æƒ³è¦çš„åŠŸèƒ½ã€‚ä½†è‹¦äº qrspeed è¯åº“ç®—ä¸ä¸ŠçœŸæ­£çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ‰€ä»¥ä¸€ç›´æ‹¿ä¸å‡ºæ‰‹ã€‚åæ¥å› ä¸ºå¯„å®¿å­¦æ ¡ï¼Œç‰ˆæœ¬æ›´æ–°å¾ˆå¿«ï¼Œé€æ¸è·Ÿä¸ä¸Šäº†è¯­æ³•çš„å˜åŒ–äº†ã€‚

åæ¥ï¼Œæ™¨é£æœºå™¨äººä½œè€…å–èŒ¶ï¼Œé…· Q å…³ç«™ï¼Œqrspeed ä¹Ÿåœè¿ï¼Œå— tx æ‰“å‹ QQ æœºå™¨äººå‡ ä¹æ­»è·¯ä¸€æ¡ã€‚é«˜ä¸­äº†è§£åˆ° nonebot2ï¼Œç¯å¢ƒä¸ä¼šæ­ï¼Œæ”¾å¼ƒäº†ä¸Šå¤§å­¦ä¹‹åäº†è§£åˆ° miraiï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸‰ä¸ªç”¨äº†å¾ˆä¹…ä¸€æ®µæ—¶é—´çš„æœºå™¨äººæ¡†æ¶ï¼Œå¯æƒœçš„æ˜¯ï¼Œæˆ‘è®¤è¯†ä»–çš„æ—¶å€™ä»–å°±å·²ç»åˆ°å¯’å†¬äº†ï¼Œéšå¤„å¯è§çš„ code = 45ï¼Œå°è¿‡ n æ¬¡çš„ QQ å·.....ä¸è¿‡æˆ‘ä¾æ—§æƒ³è‡ªå·±å¼€å‘è‡ªå·±æƒ³è¦çš„åŠŸèƒ½ï¼Œç”±äº mirai åŸºäº kotlinï¼Œå­¦äº†ä¸€æ®µæ—¶é—´ kotlin æ²¡å­¦ä¼šï¼Œç¯å¢ƒä¹Ÿæ²¡æ­å¥½ï¼Œåˆæ”¾å¼ƒäº†ï¼Œè¿˜å› æ­¤è®¤è¯†äº†å°ç™½å¸ˆå‚…ã€‚ï¼ˆç”µè„‘ä¹Ÿå› æ­¤ä¸­äº†ä¸€æ¬¡è •è™«ï¼‰

å¤§äºŒï¼Œè®¤è¯†äº† koishi å’Œ napcatQQï¼Œä¸€å¼€å§‹ä¸æ‡‚ Websocket åè®®ï¼Œä¹Ÿæ²¡æ·±å…¥äº†è§£ napcatQQ çš„å·¥ä½œåŸç†ï¼Œä»ç„¶æ˜¯åªä¼šå®‰è£…åˆ«äººå†™å¥½çš„ koishi æ’ä»¶ï¼Œå¥ˆä½•æˆ‘ 2c2g çš„æœåŠ¡å™¨è·‘ koishi å¾ˆæ…¢ï¼ŒåŸºäº TypeScript çš„ koishiï¼Œæœ¬æ¥æ‰“ç®—è¿™æ¬¡æš‘å‡å­¦ä¸€å­¦è‡ªå·±å¼€å‘ TS æ’ä»¶ã€‚

ä½†æ˜¯ï¼Œä»Šå¤©å¿½ç„¶æƒ³èµ·æ¥å…ˆå‰ Liu æåˆ°è¿‡ä¸€æ¬¡åŸºäº Python å’Œ napcatQQ çš„ï¼Œä»–å·²ç»å®ç°äº†ï¼Œæˆ‘ä¹Ÿå¯ä»¥è¯•è¯•ï¼Œçœ‹çœ‹å¥—ç¥ mumuzi çš„åšå®¢åŸºäº http åè®®å¤„ç†æ¶ˆæ¯ï¼Œå€ŸåŠ© ChatGPT å®ç°äº†å’Œä»–å®Œå…¨ä¸ä¸€æ ·çš„ WebSocket åè®®ï¼Œæäº†æ•´æ•´ä¸€ä¸‹åˆä¸€ä¸ªæ™šä¸Šï¼ŒåŸºæœ¬å®ç°äº†æ•æ„Ÿè¯ç›‘æ§ï¼Œç¦è¨€è§£ç¦ï¼Œæ’¤å›ç­‰åŠŸèƒ½ã€‚ï¼ˆgithub.com/W1ndys/botï¼‰æ„Ÿè§‰è¿˜æ˜¯ ChatGPT ç‰›é€¼ï¼Œæˆ‘ä¸€ä¸ªä»æ¥æ²¡å¬è¯´è¿‡ Python å¼‚æ­¥çš„å°ç™½éƒ½èƒ½å†™å‡ºæ¥æƒ³è¦çš„åŠŸèƒ½ã€‚

çœŸæ­£çš„ç¼–ç¨‹è¯­è¨€å®ç°ï¼ŒçœŸæ­£æ–¹ä¾¿çš„ç¯å¢ƒæ­å»ºä¸€åˆ‡éƒ½å¾—ç›Šäºå¼€ç®±å³ç”¨çš„ Python å’Œä¸‡èƒ½çš„ ChatGPT å››å¹´ï¼Œç»ˆäºæ‰¾åˆ°å½“å¹´çš„æ„Ÿè§‰äº†ã€‚

## åŸºç¡€å‡†å¤‡

1. å®‰è£…ç¯å¢ƒï¼š[NapCatQQ (napneko.github.io)](https://napneko.github.io/zh-CN/)

   æˆ‘è¿™é‡ŒåŸºäº Linux æœåŠ¡å™¨è¿è¡Œçš„æœºå™¨äººï¼Œæ‰€ä»¥ä¸‹é¢ç¯å¢ƒå‡ ä¹éƒ½æ˜¯åŸºäº Linux å‘½ä»¤è¡Œçš„ï¼Œå¦‚æœä½ ç”¨ Windows çš„è¯ï¼Œåº”è¯¥ä¹Ÿèƒ½çœ‹æ‡‚ï¼ŒWindows å›¾å½¢åŒ–æ¯” Linux å‘½ä»¤è¡Œç®€å•ä¸€äº›

2. å¯¹äº Linux æœåŠ¡å™¨æ¥è¯´ï¼Œä½ éœ€è¦æ‹¥æœ‰ä¸€ä¸ªå…¬ç½‘ IPï¼Œå¯ä»¥åœ¨è…¾è®¯äº‘æˆ–è€…é˜¿é‡Œäº‘è´­ä¹°ä¸€ä¸ª win æœåŠ¡å™¨æˆ–è€… linux æœåŠ¡å™¨ï¼Œæˆ‘ç”¨çš„æ˜¯åœ¨é˜¿é‡Œäº‘çš„ 2c2g çš„ Ubuntu

3. æˆ‘é»˜è®¤ä½ é˜…è¯»è¿‡æé—®çš„æ™ºæ…§ã€æœ‰åŸºæœ¬çš„ Linux æ“ä½œç³»ç»Ÿç»éªŒã€æœ‰å¯¹ Github åŸºæœ¬çš„è®¤è¯†ã€æœ‰ pip å®‰è£…çš„åŸºç¡€ï¼Œä¸ä¼šå¯ä»¥é—®æˆ‘

### å®‰è£…è¿è¡Œç¯å¢ƒ

è¯·ä»”ç»†é˜…è¯» [NapCatQQ (napneko.github.io)](https://napneko.github.io/zh-CN/)ï¼Œå†™çš„å·²ç»å¾ˆè¯¦ç»†äº†

è¿™é‡Œè¯¦ç»†è¯´ä¸€ä¸‹ä¸€äº›ç»†èŠ‚

#### å®‰è£… QQ

å®‰è£…å¿…è¦çš„ä¾èµ–

```bash
sudo apt install libgbm1 libasound2
```

è¿›å…¥ [NapCatQQ æ–‡æ¡£](https://napneko.github.io/zh-CN/guide/version)ï¼Œæ–‡æ¡£æä¾›äº†å¯ç”¨çš„ LinuxQQ çš„ä¸‹è½½

è¿™é‡Œä»¥ `linuxqq_3.2.7-23361_amd64.deb` ä¸ºä¾‹

ä¸‹è½½å®‰è£…åŒ…

```bash
wget https://dldir1.qq.com/qqfile/qq/QQNT/8b4fdf81/linuxqq_3.2.7-23361_amd64.deb
```

ä¸‹è½½å®Œæˆåç»™äºˆæƒé™å¹¶è¿è¡Œå®‰è£…

```bash
chmod +x linuxqq_3.2.7-23361_amd64.deb
sudo apt install./linuxqq_3.2.7-23361_amd64.deb -y
```

#### å®‰è£… NapCatQQ

ä¸‹è½½åœ°å€: https://github.com/NapNeko/NapCatQQ/releases

ç”±äºæœåŠ¡å™¨å¯¹äº Github çš„è¿æ¥æ€§ä¸ç¨³å®šï¼Œé­”æ³•ä¹Ÿä¸å¥½å¼€ï¼Œå»ºè®®åœ¨æœ¬æœºä¸‹è½½ä¹‹åä¸Šä¼ åˆ°æœåŠ¡å™¨

#### å¯åŠ¨ NatCatQQ

åœ¨ `NapCat.linux.x64` ç›®å½•ä¸‹èƒ½çœ‹åˆ° `napcat.sh` æ–‡ä»¶ï¼Œæ·»åŠ æƒé™å¹¶å¯åŠ¨

```bash
chmod u+x ./napcat.sh
./napcat.sh
```

æ­¤æ—¶è®©æ‰«ç ç™»å½•ï¼Œç”¨æ‰‹æœº QQ ç™»å½•ä¸Šæå‰å‡†å¤‡å¥½çš„ QQ å°å·ï¼Œä¸Šå·ä¹‹åæ‰«æäºŒç»´ç ï¼Œæ¨èæ‰«æä¿å­˜åˆ°æœ¬åœ°çš„äºŒç»´ç 

#### åç»­å¯åŠ¨è¯¥ QQ

ä½¿ç”¨-q é‡æ–°ç™»å½•å³å¯æ— éœ€æ‰«ç ï¼Œä¾‹å¦‚ `napcat.sh -q 1234567`

#### é…ç½®é€šä¿¡è¿æ¥

å®‰å…¨ç»„æ”¾è¡Œ `6099` ç«¯å£

è®¿é—®ä½ çš„ `http://IP:6099/webui/login.html`ï¼Œtoken å¯†ç å¯åœ¨ `./config/webui.json` ä¸‹æ‰¾åˆ°

è¿›å…¥ååˆ°ä»¥ä¸‹ç•Œé¢

æˆ‘æ˜¯åŸºäº `æ­£å‘ WebSocket åè®®`ï¼ˆä»¥ä¸‹ç®€ç§° `wsã€wsåè®®`ï¼‰ è¿›è¡Œé€šä¿¡ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©åŸºäº `http åè®®` è¿›è¡Œé€šä¿¡

**è¿™ä¸€æ­¥è‡³å…³é‡è¦ï¼Œè¿™å†³å®šäº†ä»¥åè„šæœ¬çš„ä¹¦å†™æ–¹æ³•çš„å®ç°**

> æœ‰å…³äº `http åè®®` çš„é€šä¿¡å®ç°ï¼Œå¯ä»¥çœ‹å¥—ç¥çš„åšå®¢ [ä½¿ç”¨ NapCatQQ æ­å»º QQ æœºå™¨äºº | mumuzi çš„ blog (mumuzi7179.github.io)](https://mumuzi7179.github.io/docs/Blog/QQBot/ä½¿ç”¨NapCatQQæ­å»ºQQBot)

![image-20240728190134771](./../img/QQbot/image-20240728190134771.png)

è¿™é‡Œæˆ‘è®¾ç½®çš„ 3001 ç«¯å£ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œåªè¦æ˜¯ä¸å†²çªçš„å³å¯ï¼Œå¦‚æœä½ æ˜¯åœ¨å†…ç½‘çš„è¯ï¼Œå¯ä»¥ä¸è®¾ç½® AsscessTokenï¼Œå¯ä»¥ç•™ç©ºï¼ˆä½†æ˜¯ä¸è¦åœ¨å®‰å…¨ç»„å¼€æ”¾è¿™ä¸ªç«¯å£ï¼‰ï¼Œå¦‚æœä½ æ˜¯å…¬ç½‘é€šè¿‡å¤–éƒ¨å…¬ç½‘è¿›è¡Œé€šä¿¡ï¼Œå®‰å…¨èµ·è§ä¸€å®šè¦è®¾ç½® AccessTokenï¼Œè¿™æ ·åˆ«äººå°±æ— æ³•ç›´æ¥è®¿é—®ä½ çš„æœºå™¨äººäº†ï¼Œéœ€è¦é€šè¿‡ä½ çš„ AccessToken æ‰å¯ä»¥è®¿é—®ã€‚

## å®ç°åŠŸèƒ½

æˆ‘è‡ªå·±ç”¨çš„æœºå™¨äººçš„æ‰€æœ‰ä»£ç éƒ½å¼€æºåœ¨ [W1ndys/W1ndys_QQ_Bot: åŸºäº Python å’Œ NapcatQQ çš„ QQ æœºå™¨äºº (github.com)](https://github.com/W1ndys/W1ndys_QQ_Bot#/)ï¼Œå¯ä»¥å‚è€ƒæ›´æ–¹ä¾¿ç†è§£

### API æ¥å£

NapCatQQ å®ç°äº† [OneBot 11](https://11.onebot.dev/) ä»¥åŠ [go-cqhttp](https://docs.go-cqhttp.org/api) çš„å¤§éƒ¨åˆ† APIï¼Œå¯ä»¥ç›´æ¥ç‚¹å‡»æŸ¥çœ‹ APIï¼Œè¯¦ç»†å¯æŸ¥çœ‹ https://napneko.github.io/zh-CN/develop/api

### æµ‹è¯•æ¶ˆæ¯å‘é€

å‡è®¾å°å·ä¸å¤§å·åˆ›å»ºäº†ä¸€ä¸ªç¾¤èŠï¼Œè¿™é‡Œæµ‹è¯•çš„æ˜¯ç¾¤èŠä¸­æ˜¯å¦å‡ºç°æŒ‡å®šå­—ç¬¦ä¸²ï¼Œå‡ºç°åˆ™å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä»¥â€œæµ‹è¯•â€å’Œâ€œæµ‹è¯•æˆåŠŸâ€ä¸ºä¾‹

```Python
import json
import logging
import asyncio
import websockets
import re
import colorlog

# å…¨å±€é…ç½®
global owner, ws_url, token

owner = [123456789]  # æœºå™¨äººç®¡ç†å‘˜ QQ å·
ws_url = "ws://127.0.0.1:3001"  # napcatQQ ç›‘å¬çš„ WebSocket API åœ°å€
token = None  # å¦‚æœéœ€è¦è®¤è¯ï¼Œè¯·å¡«å†™è®¤è¯ token

# æ—¥å¿—ç­‰çº§é…ç½®
handler = colorlog.StreamHandler()
handler.setFormatter(
    colorlog.ColoredFormatter(
        "%(log_color)s%(levelname)s:%(name)s:%(message)s",
        log_colors={
            "DEBUG": "cyan",
            "INFO": "green",
            "WARNING": "yellow",
            "ERROR": "red",
            "CRITICAL": "red,bg_white",
        },
    )
)
logging.basicConfig(level=logging.DEBUG, handlers=[handler])

# è¿æ¥åˆ° QQ æœºå™¨äºº
async def connect_to_bot():
    logging.info("æ­£åœ¨è¿æ¥åˆ°æœºå™¨äºº...")
    async with websockets.connect(ws_url) as websocket:
        logging.info("å·²è¿æ¥åˆ°æœºå™¨äººã€‚")
        # å‘é€è®¤è¯ä¿¡æ¯ï¼Œå¦‚æœéœ€è¦çš„è¯
        await authenticate(websocket)

        async for message in websocket:
            logging.info(f"æ”¶åˆ°æ¶ˆæ¯: {message}")
            await handle_message(websocket, message)

# å‘é€è®¤è¯ä¿¡æ¯
async def authenticate(websocket):
    if token:
        auth_message = {"action": "authenticate", "params": {"token": token}}
        await websocket.send(json.dumps(auth_message))
        logging.info("å·²å‘é€è®¤è¯ä¿¡æ¯ã€‚")
    else:
        logging.info("æœªæä¾› tokenï¼Œè·³è¿‡è®¤è¯ã€‚")

# å‘é€ç¾¤æ¶ˆæ¯
async def send_group_msg(websocket, group_id, content):
    message = {
        "action": "send_group_msg",
        "params": {"group_id": group_id, "message": content},
    }
    await websocket.send(json.dumps(message))
    logging.info(f"å·²å‘é€æ¶ˆæ¯åˆ°ç¾¤ {group_id}: {content}")

async def handle_message(websocket, message):
    try:
        msg = json.loads(message)
        logging.info(f"\n\n{msg}\n\n")

        # å¤„ç†ç¾¤èŠæ¶ˆæ¯
        if (
            "post_type" in msg
            and msg["post_type"] == "message"
            and msg["message_type"] == "group"
        ):
            user_id = msg["sender"]["user_id"]
            group_id = msg["group_id"]
            raw_message = msg["raw_message"]

            # æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜å‘é€çš„"æµ‹è¯•"æ¶ˆæ¯
            if user_id in owner and (raw_message == "æµ‹è¯•" or raw_message == "test"):
                logging.info("æ”¶åˆ°ç®¡ç†å‘˜çš„æµ‹è¯•æ¶ˆæ¯ã€‚")
                await send_group_msg(websocket, group_id, "æµ‹è¯•æˆåŠŸ")

    # å¤„ç†å¼‚å¸¸
    except Exception as e:
        logging.error(f"å¤„ç†æ¶ˆæ¯æ—¶å‡ºé”™: {e}")

# ä¸»å‡½æ•°
async def main():
    await connect_to_bot()  # è¿æ¥åˆ° QQ æœºå™¨äºº

if __name__ == "__main__":
    asyncio.run(main())
```

![image-20240728191204205](./../img/QQbot/image-20240728191204205.png)

### ç¾¤ç®¡

#### è¿ç¦è¯ç›‘æ§

#### ç¦è¨€è§£ç¦

#### è¸¢å‡ºç¾¤èŠ

æœ‰ç©ºå†å†™å§

## è‡´è°¢

[ChatGPT](https://chatgpt.com/)

[ä½¿ç”¨ NapCatQQ æ­å»º QQ æœºå™¨äºº | mumuzi çš„ blog (mumuzi7179.github.io)](https://mumuzi7179.github.io/docs/Blog/QQBot/ä½¿ç”¨NapCatQQæ­å»ºQQBot)
